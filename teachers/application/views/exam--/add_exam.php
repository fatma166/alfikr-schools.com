<div
	class="header__page d-flex justify-content-between align-items-start flex-row flex-wrap w-100"
>
	<div class="title_page">
		<h2>الأختبارات</h2>
		<nav>
			<ol class="breadcrumb">
				<li class="breadcrumb-item">
					<a href=""><i class="mdi mdi-home-outline"></i> الرئيسية </a>
				</li>
				<li class="breadcrumb-item" aria-current="page">
					القسم الإداري
				</li>
				<li class="breadcrumb-item active" aria-current="page">
					الأختبارات
				</li>
			</ol>
		</nav>
	</div>
</div>
<div class="add_exam_duty">
	<div class="tab-status">
            <span
				class="tab tab_one d-flex justify-content-center align-items-center flex-column active"
				style="gap: 10px"
			>
              <span class="circle">
                <svg
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					xmlns="http://www.w3.org/2000/svg"
				>
                  <path
					  opacity="0.4"
					  d="M7.86866 15.4599L7 21.9999L11.5884 19.2469C11.7381 19.1571 11.8129 19.1122 11.8928 19.0947C11.9634 19.0791 12.0366 19.0791 12.1072 19.0947C12.1871 19.1122 12.2619 19.1571 12.4116 19.2469L17 21.9999L16.1319 15.457"
					  stroke="black"
					  stroke-width="2"
					  stroke-linecap="round"
					  stroke-linejoin="round"
				  />
                  <path
					  d="M16.4259 4.24888C16.5803 4.6224 16.8768 4.9193 17.25 5.0743L18.5589 5.61648C18.9325 5.77121 19.2292 6.06799 19.384 6.44154C19.5387 6.81509 19.5387 7.23481 19.384 7.60836L18.8422 8.91635C18.6874 9.29007 18.6872 9.71021 18.8427 10.0837L19.3835 11.3913C19.4602 11.5764 19.4997 11.7747 19.4997 11.975C19.4998 12.1752 19.4603 12.3736 19.3837 12.5586C19.3071 12.7436 19.1947 12.9118 19.0531 13.0534C18.9114 13.195 18.7433 13.3073 18.5582 13.3839L17.2503 13.9256C16.8768 14.0801 16.5799 14.3765 16.4249 14.7498L15.8827 16.0588C15.728 16.4323 15.4312 16.7291 15.0577 16.8838C14.6841 17.0386 14.2644 17.0386 13.8909 16.8838L12.583 16.342C12.2094 16.1877 11.7899 16.188 11.4166 16.3429L10.1077 16.8843C9.73434 17.0387 9.31501 17.0386 8.94178 16.884C8.56854 16.7293 8.27194 16.4329 8.11711 16.0598L7.57479 14.7504C7.42035 14.3769 7.12391 14.08 6.75064 13.925L5.44175 13.3828C5.06838 13.2282 4.77169 12.9316 4.61691 12.5582C4.46213 12.1849 4.46192 11.7654 4.61633 11.3919L5.1581 10.0839C5.31244 9.71035 5.31213 9.29079 5.15722 8.91746L4.61623 7.60759C4.53953 7.42257 4.50003 7.22426 4.5 7.02397C4.49997 6.82369 4.5394 6.62536 4.61604 6.44032C4.69268 6.25529 4.80504 6.08716 4.94668 5.94556C5.08832 5.80396 5.25647 5.69166 5.44152 5.61508L6.74947 5.07329C7.12265 4.91898 7.41936 4.6229 7.57448 4.25004L8.11664 2.94111C8.27136 2.56756 8.56813 2.27078 8.94167 2.11605C9.3152 1.96132 9.7349 1.96132 10.1084 2.11605L11.4164 2.65784C11.7899 2.81218 12.2095 2.81187 12.5828 2.65696L13.8922 2.11689C14.2657 1.96224 14.6853 1.96228 15.0588 2.11697C15.4322 2.27167 15.729 2.56837 15.8837 2.94182L16.426 4.25115L16.4259 4.24888Z"
					  stroke="black"
					  stroke-width="2"
					  stroke-linecap="round"
					  stroke-linejoin="round"
				  />
                </svg>
              </span>
              <span class="title"> تفاصيل الأختبار </span>
            </span>
		<span
			class="tab tab_two d-flex justify-content-center align-items-center flex-column"
			style="gap: 10px"
		>
              <span class="circle">
                <svg
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					xmlns="http://www.w3.org/2000/svg"
				>
                  <path
					  opacity="0.4"
					  d="M4 9.5V16.3066C4 16.6785 4 16.8645 4.05802 17.0273C4.10931 17.1712 4.1929 17.3015 4.30238 17.4081C4.42621 17.5287 4.59527 17.6062 4.93335 17.7611L11.3334 20.6945C11.5786 20.8069 11.7012 20.8631 11.8289 20.8852C11.9421 20.9049 12.0579 20.9049 12.1711 20.8852C12.2988 20.8631 12.4214 20.8069 12.6666 20.6945L19.0666 17.7611C19.4047 17.6062 19.5738 17.5287 19.6976 17.4081C19.8071 17.3015 19.8907 17.1712 19.942 17.0273C20 16.8645 20 16.6785 20 16.3066V9.5"
					  stroke="black"
					  stroke-width="2"
					  stroke-linecap="round"
					  stroke-linejoin="round"
				  />
                  <path
					  d="M17 14.5001V11.4945C17 11.315 17 11.2253 16.9727 11.146C16.9485 11.076 16.9091 11.0122 16.8572 10.9592C16.7986 10.8993 16.7183 10.8592 16.5578 10.779L12 8.50006M2 8.50006L11.6422 3.67895C11.7734 3.61336 11.839 3.58056 11.9078 3.56766C11.9687 3.55622 12.0313 3.55622 12.0922 3.56766C12.161 3.58056 12.2266 3.61336 12.3578 3.67895L22 8.50006L12.3578 13.3212C12.2266 13.3868 12.161 13.4196 12.0922 13.4325C12.0313 13.4439 11.9687 13.4439 11.9078 13.4325C11.839 13.4196 11.7734 13.3868 11.6422 13.3212L2 8.50006Z"
					  stroke="black"
					  stroke-width="2"
					  stroke-linecap="round"
					  stroke-linejoin="round"
				  />
                </svg>
              </span>
              <span class="title"> اضافة اختبار </span>
            </span>
	</div>
	<div role="tab-list" class="tab-list">
		<form class="needs-validation" id="add_examm_form">
			<div role="tabpanel" id="details__tab" class="tabpanel w-100">
				<div class="row">
					<div class="col-md-6">
						<div
							class="input_form d-flex justify-content-start align-items-start flex-column gap-2 w-100 mb-4"
						>
							<label for=""> اسم الأختبار </label>
							<input
								name="exam_title"
								type="text"
								class="form-control"
								placeholder="اسم الأختبار "
								aria-label="password"
							/>
							<div class="invalid-feedback d-block" id="nex_title"></div>
						</div>
					</div>
					<div class="col-md-6">
						<div
							class="input_form d-flex justify-content-start align-items-start flex-column gap-2 w-100 mb-4"
						>
							<label for="" class=""> المرحلة </label>
							<select
								name="course_types_stages"
								id="q_free_stages"
								class="form-select form-control" onchange="change_class('q_free')"
							>
								<option selected disabled>المرحله</option>


								<?php foreach($course_types as $course_type_arr) { ?>
									<option value="<?php if(isset($course_type_arr[0]->parent_id)&&$course_type_arr[0]->parent_id==0) echo $course_type_arr[0]->id;?>"> <?php if(isset($course_type_arr[0]->ar_name)&&$course_type_arr[0]->parent_id==0)  echo $course_type_arr[0]->ar_name;?></option>
								<?php }?>

							</select>
							<div class="invalid-feedback d-block" id="nex_course_types_stages"></div>

						</div>
					</div>
					<div class="col-md-6">
						<div
							class="input_form d-flex justify-content-start align-items-start flex-column gap-2 w-100 mb-4"
						>
							<label for="" class=""> الصف الدراسي </label>
							<select
								name="course_types_class"
								id="q_free_class"
								class="form-select form-control"
							>
								<option selected disabled>الصف الدراسي</option>

							</select>

							<div class="invalid-feedback d-block" id="nex_course_types_class"></div>
						</div>
					</div>
					<div class="col-md-6">
						<div
							class="input_form d-flex justify-content-start align-items-start flex-column gap-2 w-100 mb-4"
						>
							<label for="" class=""> الشعبة </label>
							<select
								name="question_group_id"
								id="question_group_id"
								class="form-select form-control"
							>
								<option selected disabled>الشعبة</option>

							</select>
							<div class="invalid-feedback d-block" id="nex_question_group_id"></div>
						</div>
					</div>

					<div class="col-md-6">
						<div class="input_form mb-4">
							<label for="" class="mb-3"> الماده العلميه </label>
							<select
								name="question_subject_id"
								id="question_subject_id"
								class="form-select form-control"
							>
								<option selected disabled>الماده العلميه</option>

							</select>
						</div>
					</div>
					<div class="col-md-6">
						<div
							class="input_form d-flex justify-content-start align-items-start flex-column gap-2 w-100 mb-4"
						>
							<label for=""> تاريخ بداية الأختبار </label>
							<input
								name="start_date"
								type="date"
								class="form-control"
								placeholder=" تاريخ بداية الأختبار"
								aria-label="date"
							/>
							<div class="invalid-feedback d-block" id="nex_start_date"></div>
						</div>
					</div>
					<div class="col-md-6">
						<div
							class="input_form d-flex justify-content-start align-items-start flex-column gap-2 w-100 mb-4"
						>
							<label for=""> تاريخ نهاية الأختبار </label>
							<input
								name="end_date"
								type="date"
								class="form-control"
								placeholder=" تاريخ نهاية الأختبار"
								aria-label="date"
							/>
							<div class="invalid-feedback d-block" id="nex_end_date"></div>
						</div>
					</div>
					<div class="col-md-6">
						<div
							class="input_form d-flex justify-content-start align-items-start flex-column gap-2 w-100 mb-4"
						>
							<label for=""> مدة الأختبار </label>
							<input
								name="time"
								type="number"
								class="form-control"
								placeholder="مدة الأختبار "
								aria-label="date"
							/>
							<div class="invalid-feedback d-block" id="nex_time"></div>
						</div>
					</div>
					<div class="col-md-6">
						<div
							class="input_form d-flex justify-content-start align-items-start flex-column gap-2 w-100 mb-4"
						>
							<label for=""> الدرجة النهائية </label>
							<input
								name="degree"
								type="number"
								class="form-control"
								placeholder=" الدرجة النهائية "
								aria-label="date"
							/>
							<div class="invalid-feedback d-block" id="nex_degree"></div>
						</div>
					</div>
					<div class="col-md-6">
						<div
							class="input_form d-flex justify-content-start align-items-start flex-column gap-2 w-100 mb-4"
						>
							<label for=""> درجة النجاح </label>
							<input
								name="passdegree"
								type="number"
								class="form-control"
								placeholder="درجة النجاح "
								aria-label="date"
							/>
							<div class="invalid-feedback d-block" id="nex_passdegree"></div>
						</div>
					</div>
					<div class="col-md-6">
						<div
							class="input_form d-flex justify-content-start align-items-start flex-column gap-2 w-100 mb-4"
						>
							<label for=""> عدد الأسئلة </label>
							<input
								name="question_count"
								type="number"
								class="form-control"
								placeholder=" عدد الأسئلة "
								aria-label="date"
							/>
							<div class="invalid-feedback d-block" id="nex_question_count"></div>
						</div>
					</div>
					<div class="col-md-12">
						<div
							class="add__note__div input_form d-flex justify-content-start align-items-start flex-column gap-2 mb-4 w-100"
						>
							<label for=""> الملحوظات </label>
							<input
								name="notes[]"
								type="text"
								class="form-control"
								placeholder=" الملحوظات "
								aria-label="date"
							/>
							<div class="invalid-feedback d-block" id="nex_notes"></div>
						</div>
					</div>
					<button class="add__note">أضافة ملحوظة اخرى</button>
				</div>
				<div
					class="btn__ d-flex justify-content-center align-items-center flex-row mt-5"
				>
					<button class="continue__btn">التالي</button>
				</div>
			</div>
			<div role="tabpanel" id="exam__tab" class="tabpanel hidden">
				<ul class="nav nav-tabs mb-5" id="myTab" role="tablist">
					<li class="nav-item" role="presentation">
						<button
							class="nav-link active"
							id="bank-tab"
							data-bs-toggle="tab"
							data-bs-target="#bank-tab-pane"
							type="button"
							role="tab"
							aria-controls="bank-tab-pane"
							aria-selected="true"
						>
							<svg
								width="24"
								height="24"
								viewBox="0 0 24 24"
								fill="none"
								xmlns="http://www.w3.org/2000/svg"
							>
								<path
									d="M12.37 2.15009L21.37 5.75006C21.72 5.89006 22 6.31006 22 6.68006V10.0001C22 10.5501 21.55 11.0001 21 11.0001H3C2.45 11.0001 2 10.5501 2 10.0001V6.68006C2 6.31006 2.28 5.89006 2.63 5.75006L11.63 2.15009C11.83 2.07009 12.17 2.07009 12.37 2.15009Z"
									stroke="#292D32"
									stroke-width="1.5"
									stroke-miterlimit="10"
									stroke-linecap="round"
									stroke-linejoin="round"
								/>
								<path
									d="M22 22H2V19C2 18.45 2.45 18 3 18H21C21.55 18 22 18.45 22 19V22Z"
									stroke="#292D32"
									stroke-width="1.5"
									stroke-miterlimit="10"
									stroke-linecap="round"
									stroke-linejoin="round"
								/>
								<path
									d="M4 18V11"
									stroke="#292D32"
									stroke-width="1.5"
									stroke-miterlimit="10"
									stroke-linecap="round"
									stroke-linejoin="round"
								/>
								<path
									d="M8 18V11"
									stroke="#292D32"
									stroke-width="1.5"
									stroke-miterlimit="10"
									stroke-linecap="round"
									stroke-linejoin="round"
								/>
								<path
									d="M12 18V11"
									stroke="#292D32"
									stroke-width="1.5"
									stroke-miterlimit="10"
									stroke-linecap="round"
									stroke-linejoin="round"
								/>
								<path
									d="M16 18V11"
									stroke="#292D32"
									stroke-width="1.5"
									stroke-miterlimit="10"
									stroke-linecap="round"
									stroke-linejoin="round"
								/>
								<path
									d="M20 18V11"
									stroke="#292D32"
									stroke-width="1.5"
									stroke-miterlimit="10"
									stroke-linecap="round"
									stroke-linejoin="round"
								/>
								<path
									d="M1 22H23"
									stroke="#292D32"
									stroke-width="1.5"
									stroke-miterlimit="10"
									stroke-linecap="round"
									stroke-linejoin="round"
								/>
								<path
									d="M12 8.5C12.8284 8.5 13.5 7.82843 13.5 7C13.5 6.17157 12.8284 5.5 12 5.5C11.1716 5.5 10.5 6.17157 10.5 7C10.5 7.82843 11.1716 8.5 12 8.5Z"
									stroke="#292D32"
									stroke-width="1.5"
									stroke-miterlimit="10"
									stroke-linecap="round"
									stroke-linejoin="round"
								/>
							</svg>

							بنك الأسئلة
						</button>
					</li>
					<li class="nav-item" role="presentation">
						<button
							class="nav-link"
							id="adding-tab"
							data-bs-toggle="tab"
							data-bs-target="#adding-tab-pane"
							type="button"
							role="tab"
							aria-controls="adding-tab-pane"
							aria-selected="false"
						>
							<svg
								width="24"
								height="24"
								viewBox="0 0 24 24"
								fill="none"
								xmlns="http://www.w3.org/2000/svg"
							>
								<path
									d="M12 5V19M5 12H19"
									stroke="black"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
								/>
							</svg>

							اضافة اسئلة أخرى
						</button>
					</li>
				</ul>
				<div class="tab-content mt-4" id="myTabContent">

					<?php include ('partails/questions.php')?>

				</div>
				<div class="mt-4 d-flex justify-content-center align-items-center flex-row">
					<button class="submit" id="add_examm"> تأكيد </button>
				</div>
			</div>
			<div class="form__actions mt-5 d-none">
				<button id="prev__btn" class="">السابق</button>
			</div>

		</form>
	</div>
</div>




<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    const previousButton = document.querySelector("#prev__btn");
    const tabTargets = document.querySelectorAll(".tab");
    const tabPanels = document.querySelectorAll(".tabpanel");
    const isEmpty = (str) => !str.trim().length;
    let currentStep = 0;

    previousButton.addEventListener("click", (event) => {
        event.preventDefault();
        tabPanels[currentStep].classList.add("hidden");
        //   tabTargets[currentStep].classList.remove('active');
        tabPanels[currentStep - 1].classList.remove("hidden");
        //   tabTargets[currentStep - 1].classList.add('active');
        currentStep -= 1;
        updateStatusDisplay();
    });

    function updateStatusDisplay() {
        if (currentStep === tabTargets.length - 1) {
            previousButton.classList.add("hidden");
            document.querySelector(".tab_one").classList.add("active");
            document.querySelector(".tab_two").classList.add("active");
            // document.querySelector(".tab_three").classList.add("active");
        } else if (currentStep == 0) {
            previousButton.classList.add("hidden");
            document.querySelector(".tab_one").classList.add("active");
            document.querySelector(".tab_two").classList.remove("active");
            //   document.querySelector(".tab_three").classList.remove("active");
        } else if (currentStep == 1) {
            previousButton.classList.remove("hidden");
            document.querySelector(".tab_one").classList.add("active");
            document.querySelector(".tab_two").classList.add("active");
            //  document.querySelector(".tab_three").classList.remove("active");
        } else {
            previousButton.classList.add("hidden");
        }
    }

    const continueButtons = document.querySelectorAll(".continue__btn");
    continueButtons.forEach((continueButton) => {
        continueButton.addEventListener("click", (event) => {
            event.preventDefault();
            if (validateForm()) {
                var course_types_class = $('select[name="course_types_class"]').val();

                var group_id = $('select[name="question_group_id"]').val();

                $.ajax({
                    type:"post",
                    url: "<?Php echo base_url(); ?>exam/getquestion",
                    data:{'course_type':course_types_class,'group_id':group_id},//$("#free_form").serialize(),
                    //processData: false, // Prevent jQuery from automatically processing the data
                    // contentType: false,
                    headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                    success: function(data1) {
                        $('#myTabContent').empty();
                        $('#myTabContent').append(data1);


                    } ,
                    error: function(xhr, status, error) {
                        // Handle the error response
                        var errorResponse = JSON.parse(xhr.responseText);
                        showErrors(errorResponse.errors);

                        //  console.log('Error occurred while fetching options');
                        Swal.fire({
                            title: "<?php echo $this->lang->line('Error')?>",
                            text:  "<?php echo $this->lang->line('An error occurred while') .$this->lang->line('free question saved') ?>",
                            icon: 'error',
                            confirmButtonText: "<?php echo $this->lang->line('OK')?>"
                        });
                    }


                });
                tabPanels[currentStep].classList.add("hidden");
                // tabTargets[currentStep].classList.remove('active');
                tabPanels[currentStep + 1].classList.remove("hidden");
                // tabTargets[currentStep + 1].classList.add('active');
                currentStep += 1;
                updateStatusDisplay();
            }
        });
    });

</script>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        function toggleForms() {
            var freeQuestionForm2 = document.getElementById('question_exist_free');
            var listQuestionForm2 = document.getElementById('question_exist_list');

            // Get the checked radio button
            var freeQuestionChecked2 = document.getElementById('free-question').checked;
            var listQuestionChecked2 = document.getElementById('list-questions').checked;

            // Show/hide forms based on checked state
            if (freeQuestionChecked2) {
                freeQuestionForm2.style.display = 'block';
                listQuestionForm2.style.display = 'none';
            } else {
                freeQuestionForm2.style.display = 'none';
                listQuestionForm2.style.display = 'block';
            }
        }

        // Listen for changes in the radio buttons' checked state
        var radioButtons = document.querySelectorAll('.btn-check');
        radioButtons.forEach(function(button) {
            button.addEventListener('change', toggleForms);
        });

        // Initially call toggleForms to set initial visibility
        toggleForms();
    });

</script>

<script>
    document.getElementById('add_another_question_free').addEventListener('click', function() {
        //    alert("fdshjhfdj");
        var container = document.getElementById('questions_container');
        var newQuestion = document.querySelector('.free_question_ques').cloneNode(true);

        // Create delete button
        var deleteButton = document.createElement('button');
        deleteButton.textContent = 'حذف';
        deleteButton.className = 'delete_question';
        deleteButton.addEventListener('click', function() {
            newQuestion.remove();
        });

        // Append delete button to new question
        newQuestion.appendChild(deleteButton);

        // Append new question to container
        container.appendChild(newQuestion);
    });
</script>


<script>
    // Function to add a new note
    function addNote() {
        const notesContainer = document.querySelector('.row');

        // Create new note div
        const newNoteDiv = document.createElement('div');
        newNoteDiv.classList.add('col-md-12');
        newNoteDiv.innerHTML = `
      <div class="add__note__div input_form d-flex justify-content-start align-items-start flex-column gap-2 mb-3 w-100">
        <input type="text" class="form-control" placeholder="الملحوظات" aria-label="date">
        <button class="delete__note" onclick="deleteNote(this)">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path opacity="0.4" d="M16 6V5.2C16 4.0799 16 3.51984 15.782 3.09202C15.5903 2.71569 15.2843 2.40973 14.908 2.21799C14.4802 2 13.9201 2 12.8 2H11.2C10.0799 2 9.51984 2 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8 3.51984 8 4.0799 8 5.2V6M10 11.5V16.5M14 11.5V16.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 6H21M19 6V17.2C19 18.8802 19 19.7202 18.673 20.362C18.3854 20.9265 17.9265 21.3854 17.362 21.673C16.7202 22 15.8802 22 14.2 22H9.8C8.11984 22 7.27976 22 6.63803 21.673C6.07354 21.3854 5.6146 20.9265 5.32698 20.362C5 19.7202 5 18.8802 5 17.2V6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    `;

        // Append new note div to notes container
        notesContainer.insertBefore(newNoteDiv, document.querySelector('.add__note'));
    }

    // Function to delete a note
    function deleteNote(btn) {
        btn.parentElement.parentElement.remove(); // Remove the entire parent div
    }

    // Event listener for adding a new note
    document.querySelector('.add__note').addEventListener('click', addNote);
</script>

<script>

    function validateForm() {

        var isValid = true;


        var title = $('input[name="exam_title"]').val();
        if (title.trim() === '') {
            isValid = false;
            $('#nex_title').text("<?php echo $this->lang->line('Please enter an title.')?>");
        }
        var course_types_stages = $('select[name="course_types_stages"]').val();

        if (course_types_stages === null || course_types_stages.trim() === '') {


            isValid = false;
            $('#nex_course_types_stages').text("<?php echo $this->lang->line('Please enter an course_types_stages.')?>");
        }

        var course_types_class = $('select[name="course_types_class"]').val();

        if (course_types_class == null) {

            isValid = false;
            $('#nex_course_types_class').text("<?php echo $this->lang->line('Please enter an course_types_class.')?>");
        }

        var nex_question_group_id = $('select[name="question_group_id"]').val();

        if (nex_question_group_id ==null) {
            isValid = false;
            $('#nex_question_group_id').text("<?php echo $this->lang->line('Please enter group_id.')?>");
        }

        var nex_question_subject_id=$('select[name="question_subject_id"]').val();

        if (nex_question_subject_id ==null) {
            isValid = false;
            $('#nex_question_subject_id').text("<?php echo $this->lang->line('Please enter subject.')?>");
        }
        var start_date = $('input[name="start_date"]').val();
        if (start_date.trim() === '') {
            isValid = false;
            $('#nex_start_date').text("<?php echo $this->lang->line('Please enter an start_date.')?>");
        }
        var end_date = $('input[name="end_date"]').val();
        if (end_date.trim() === '') {
            isValid = false;
            $('#nex_end_date').text("<?php echo $this->lang->line('Please enter an end_date.')?>");
        }
        var time = $('input[name="time"]').val();
        if (time.trim() === '') {
            isValid = false;
            $('#nex_time').text("<?php echo $this->lang->line('Please enter an time.')?>");
        }

        var degree = $('input[name="degree"]').val();
        if (time.trim() === '') {
            isValid = false;
            $('#nex_degree').text("<?php echo $this->lang->line('Please enter degree.')?>");
        }
        var passdegree = $('input[name="passdegree"]').val();
        if (passdegree.trim() === '') {
            isValid = false;
            $('#nex_passdegree').text("<?php echo $this->lang->line('Please enter  passdegree.')?>");

        }
        var question_count = $('input[name="question_count"]').val();
        if (question_count.trim() === '') {
            isValid = false;
            $('#nex_question_count').text("<?php echo $this->lang->line('Please enter  question_count.')?>");

        }
        return isValid;
    }

    function change_class(id){

        stage_id =  $('#'+id+'_stages').val();//$(this).val();

        // Clear the options in the second select menu
        $('#'+id+'_class').empty();
        $.ajax({
            type:"get",
            url: "<?Php echo base_url(); ?>questionBank/getchild_stage",
            data: {'stage_id': stage_id},
            dataType: 'json',
            //  headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
            success: function(data1) {


                // Add the new options based on the selected value
                if (stage_id) {

                    $.each(data1, function (index, value) {

                        $('#'+id+'_class').append('<option value="' + value.id + '">' + value.ar_name + '</option>');
                        if(index==0){
                            getgroup(value.id);
                            getsubject(value.id, 'question_subject_id')
                        }

                    });
                } else {
                    $('#'+id+'_class').append('<option value="">Select an option</option>');
                }
            } ,
            error: function() {
                console.log('Error occurred while fetching options');
            }


        });

    }

    $(document).ready(function() {
        $('input[type="checkbox"]').on('click', function() {
            // Update the checked state of the checkbox
            $(this).prop('checked', !$(this).prop('checked'));
        });

        $("#add_examm").click(function (e) {
            e.preventDefault();

            // Create a new FormData object
            var formData = new FormData();

            // Iterate through the form fields and append them to the FormData
            $('#add_examm_form').find('input, textarea, select').each(function() {
                var $this = $(this);
                var name = $this.attr('name');

                if ($this.is('input[type="file"]')) {
                    //alert(this.files);
                    var files = this.files;
                    for (var i = 0; i < files.length; i++) {
                        // console.log(name);
                        formData.append(name, files[i]);
                    }
                } else {
                    formData.append(name, $this.val());
                }
            });
            // Get the IDs of the checked checkboxes
            const checkedCheckboxes = $('#add_examm_form input[type="checkbox"]:checked');

            const checkedIds = checkedCheckboxes.map(function() {

                return $(this).attr('id');
            }).get();
            const arrangeValues= checkedCheckboxes.map(function() {
                return $("input[name='arrange"+$(this).attr('id')+"']").val();
            }).get();

            checkedCheckboxes.each(function() {
                $(`input[name="arrange[${$(this).attr('id')}]"]`).prop('required', true);
            });

// Add the checked IDs and their order to the FormData
            formData.append('checkedIds', JSON.stringify(checkedIds));
            formData.append('arrangeValues', JSON.stringify(arrangeValues));
            console.log(formData);
            $.ajax({
                type:"post",
                url: "<?Php echo base_url(); ?>exam/save",
                data:formData,//$("#free_form").serialize(),
                processData: false, // Prevent jQuery from automatically processing the data
                contentType: false,
                headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                success: function(data1) {
                    // alert("suceess");
                    Swal.fire({
                        title: "<?php echo $this->lang->line('exam saved')?>",
                        text: "<?php echo $this->lang->line('exam has been successfully saved')?>",
                        icon: 'success',
                        confirmButtonText: "<?php echo $this->lang->line('OK')?>"
                    });

                } ,
                error: function(xhr, status, error) {
                    // Handle the error response
                    var errorResponse = JSON.parse(xhr.responseText);
                    showErrors(errorResponse.errors);

                    //  console.log('Error occurred while fetching options');
                    Swal.fire({
                        title: "<?php echo $this->lang->line('Error')?>",
                        text:  "<?php echo $this->lang->line('An error occurred while') .$this->lang->line('saved') ?>",
                        icon: 'error',
                        confirmButtonText: "<?php echo $this->lang->line('OK')?>"
                    });
                }


            });
        });

        $('#q_free_class').on('change', function () {
            class_id_= $(this).val();
            getgroup(class_id_,'question_group_id');
            getsubject(class_id_,'question_subject_id')
        });

    });
    function getgroup(class_return) {
        //
        class_id=class_return;
        // Clear the options in the second select menu
        $('#question_group_id').empty();

        $.ajax({
            type: "get",
            url: "<?Php echo base_url(); ?>questionBank/getchild_groups",
            data: {'class_id': class_id},
            dataType: 'json',
            //  headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
            success: function (data1) {


                // Add the new options based on the selected value
                if (class_id) {
                    $('#question_group_id').append('<option value="">الكل</option>');
                    $.each(data1, function (index, value) {

                        $('#question_group_id').append('<option value="' + value.id + '">' + value.name + '</option>');
                    });
                } else {
                    $('#question_group_id').append('<option value="">Select an option</option>');
                }
            },
            error: function () {
                console.log('Error occurred while fetching options');
            }


        });
        //
    }

    function getsubject(class_return,selector_name) {
        //
        class_id=class_return;
        // Clear the options in the second select menu

        $('#'+selector_name).empty();
        $.ajax({
            type: "get",
            url: "<?Php echo base_url(); ?>questionBank/getchild_subject",
            data: {'class_id': class_id},
            dataType: 'json',
            //  headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
            success: function (data1) {


                // Add the new options based on the selected value
                if (class_id) {

                    $.each(data1, function (index, value) {

                        $('#'+selector_name).append('<option value="' + value.id + '">' + value.name + '</option>');
                    });
                } else {
                    $('#'+selector_name).append('<option value="">Select an option</option>');
                }
            },
            error: function () {
                console.log('Error occurred while fetching options');
            }


        });
        //
    }
    function showErrors(errors) {
        // Clear any previous errors
        $('.is-invalid').removeClass('is-invalid');
        $('.invalid-feedback').remove();

        // Loop through the errors and display them
        $.each(errors, function(field, message) {
            // alert(field);
            var input = $('[name="' + field + '"]');
            // alert(input);
            input.addClass('is-invalid');
            input.parent().append('<div class="invalid-feedback">' + message + '</div>');
        });
    }

    $("#add_question_free").click(function (e) {
        e.preventDefault();

        // Create a new FormData object
        var formData = new FormData();

        // Iterate through the form fields and append them to the FormData
        $('#free_form').find('input, textarea, select').each(function() {
            var $this = $(this);
            var name = $this.attr('name');

            if ($this.is('input[type="file"]')) {
                //alert(this.files);
                var files = this.files;
                for (var i = 0; i < files.length; i++) {
                    // console.log(name);
                    formData.append(name, files[i]);
                }
            } else {
                formData.append(name, $this.val());
            }
        });
        // console.log(formData);
        $.ajax({
            type:"post",
            url: "<?Php echo base_url(); ?>questionBank/save",
            data:formData,//$("#free_form").serialize(),
            processData: false, // Prevent jQuery from automatically processing the data
            contentType: false,
            headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
            success: function(data1) {
                //  alert("suceess");
                Swal.fire({
                    title: "<?php echo $this->lang->line('free question saved')?>",
                    text: "<?php echo $this->lang->line('free questions has been successfully saved')?>",
                    icon: 'success',
                    confirmButtonText: "<?php echo $this->lang->line('OK')?>"
                });

            } ,
            error: function(xhr, status, error) {
                // Handle the error response
                var errorResponse = JSON.parse(xhr.responseText);
                showErrors(errorResponse.errors);

                //  console.log('Error occurred while fetching options');
                Swal.fire({
                    title: "<?php echo $this->lang->line('Error')?>",
                    text:  "<?php echo $this->lang->line('An error occurred while') .$this->lang->line('free question saved') ?>",
                    icon: 'error',
                    confirmButtonText: "<?php echo $this->lang->line('OK')?>"
                });
            }


        });
    });

    $("#add_ques_list").click(function (e) {
        // alert("list");
        e.preventDefault();
        //  alert("dsjkdsj");
        // Create a new FormData object
        var formData = new FormData();

        // Iterate through the form fields and append them to the FormData
        $('#list_form').find('input, textarea, select').each(function() {
            var $this = $(this);
            var name = $this.attr('name');

            if ($this.is('input[type="file"]')) {
                //  alert(this.files);
                var files = this.files;
                for (var i = 0; i < files.length; i++) {
                    console.log(name);
                    formData.append(name, files[i]);
                }
            } else {
                formData.append(name, $this.val());
            }
        });
        console.log(formData);
        $.ajax({
            type:"post",
            url: "<?Php echo base_url(); ?>questionBank/save",
            data:formData,//$("#free_form").serialize(),
            processData: false, // Prevent jQuery from automatically processing the data
            contentType: false,
            headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
            success: function(data1) {
                // alert("suceess");

                Swal.fire({
                    title: "<?php echo $this->lang->line('multi question saved')?>",
                    text: "<?php echo $this->lang->line('questions has been successfully saved')?>",
                    icon: 'success',
                    confirmButtonText: "<?php echo $this->lang->line('OK')?>"
                });

            } ,
            function(xhr, status, error) {
                // Handle the error response
                var errorResponse = JSON.parse(xhr.responseText);
                showErrors(errorResponse.errors);
                console.log('Error occurred while fetching options');
                Swal.fire({
                    title: "<?php echo $this->lang->line('Error')?>",
                    text:  "<?php echo $this->lang->line('An error occurred while') .$this->lang->line('save question multi') ?>",
                    icon: 'error',
                    confirmButtonText: "<?php echo $this->lang->line('OK')?>"
                });
            }


        });
    });



</script>
